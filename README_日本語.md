# バッチ電子書籍コンバーター

**他の言語 / Other Languages / 其他语言:**
- [English Version](../README.md)
- [中文版本 (Chinese)](README_中文.md)

---

様々なドキュメント形式を異なる電子書籍形式に変換するための強力なPythonツール。漫画モード（画像優先）と小説モード（テキスト優先）の両方の処理をサポートします。

## 機能

- **多形式サポート**：PDF、EPUB、CBZ、MOBI、AZW3など多数の形式間で変換
- **デュアル処理モード**：
  - 漫画モード：スキャンされたドキュメントと画像重視のコンテンツに最適化
  - 小説モード：テキストベースの電子書籍に最適化
- **バッチ処理**：フォルダ内のドキュメントを一度に処理
- **並列処理**：マルチスレッド変換で高速処理
- **インタラクティブ＆コマンドライン**：GUIライクなインタラクティブモードとコマンドラインインターフェース
- **多言語サポート**：中国語、英語、日本語インターフェース
- **自動Calibre統合**：Calibreツールの自動ダウンロードとセットアップ
- **品質制御**：調整可能な画像品質設定

## v0.0.2 (2025/8/16更新)
- **インタラクティブモードの強化:** 処理前に、スクリプトは詳細なファイル要約（合計数、形式の内訳）を提供し、ファイル名に小数を含むファイルを意図的に無視できるようになりました。
- **堅牢なエラー処理:** インタラクティブモードでファイル変換に失敗した場合、問題のあるファイルの変換を**再試行**、**スキップ**、またはプロセスを**中断**するオプションが提供され、単一の不正なファイルがバッチ全体を停止するのを防ぎます。
## インストール

### 前提条件

必要なPythonパッケージをインストール：

```bash
pip install PyMuPDF Pillow EbookLib requests tqdm natsort
```

### Calibre統合

ツールはCalibreのインストールを処理します：
- **Windows**：ポータブルCalibreの自動ダウンロードとセットアップ（Windowsのみ自動インストールをサポート）
- **Linux/macOS**：手動インストールが必要 - Calibreパスを手動で設定する必要があります
- **ネイティブ形式**：CBZとPDFのEPUB統合（漫画モードのみ）はCalibre不要

**注意**：LinuxとmacOSユーザーの場合、Calibreを手動でインストールし、`ebook-convert`ツールがシステムPATHにあることを確認する必要があります。ネイティブのCBZとPDFからEPUBへの変換（漫画モードのみ）はCalibreを必要としません。

## 使用方法

### インタラクティブモード

引数なしで実行してインタラクティブモードに入る：

```bash
python 批量电子书整合.py
```

### コマンドラインモード

```bash
python 批量电子书整合.py -p "ソースパス" -f epub -m comic
```

#### パラメータ

**必須：**
- `-p, --path`：変換するファイルを含むソースフォルダパス
- `-f, --format`：ターゲット出力形式（epub、pdf、cbz、mobiなど）
- `-m, --mode`：処理モード（`comic`または`novel`）

**オプション：**
- `-o, --output`：出力ファイルのベース名（デフォルト：フォルダ名）
- `-q, --quality`：画像品質1-100（デフォルト：85）
- `-t, --title`：メタデータ内の電子書籍タイトル
- `-l, --lang`：インターフェース言語（zh/en/ja、デフォルト：zh）
- `-w, --workers`：並列スレッド数（デフォルト：CPU数）

### 形式オプション

**一般的な形式：**
- `epub` - 汎用電子書籍形式
- `pdf` - 汎用ドキュメント形式
- `cbz` - コミックブックアーカイブ

**Kindle形式：（Calibreが必要）**
- `mobi` - 旧Kindle形式
- `azw3` - 新Kindle形式

**その他の形式（Calibreが必要）：**
- `docx`、`txt`、`kepub`、`fb2`、`lit`、`lrf`、`pdb`、`pmlz`、`rb`、`rtf`、`tcr`、`txtz`、`htmlz`

**特別：**
- `all_native` - EPUB + PDF + CBZを同時生成

## 例

### 漫画モードの例

```bash
# PDFスキャンをEPUBに変換
python 批量电子书整合.py -p "C:\MyScans" -f epub --mode comic

# CBZコミックをPDFに変換
python 批量电子书整合.py -p "D:\Comics" -f pdf --mode comic

# 複数形式に変換
python 批量电子书整合.py -p "C:\Comics" -f all_native --mode comic
```

### 小説モードの例

```bash
# EPUB小説をKindle用MOBIに変換
python 批量电子书整合.py -p "D:\Novels" -f mobi --mode novel

# 混合形式をEPUBに変換
python 批量电子书整合.py -p "E:\Books" -f epub --mode novel

# 高品質変換
python 批量电子书整合.py -p "F:\Library" -f azw3 --mode novel -q 95
```

## 処理モード

### 漫画モード
- **最適な用途**：スキャンされたドキュメント、漫画、画像重視のコンテンツ
- **処理**：ファイル → 画像 → EPUB → 最終形式
- **最適化**：画像品質とレイアウト保持

### 小説モード
- **最適な用途**：テキストベースの電子書籍、小説、ドキュメント
- **処理**：ファイル → PDF → 統合PDF → EPUB → 最終形式
- **最適化**：テキストフローと読書体験

## サポートされる入力形式

- **PDF**：スキャンされたドキュメント、デジタルPDF
- **CBZ/CBR**：コミックブックアーカイブ
- **EPUB**：デジタル電子書籍
- **MOBI/AZW3**：Kindle形式
- **その他**：Calibreがサポートする任意の形式

## 出力品質

- **画像品質**：調整可能1-100（デフォルト：85）
- **並列処理**：高速化のためのマルチスレッド
- **形式保持**：元のレイアウトとフォーマットを維持
- **メタデータ**：書籍タイトルと著者情報を保持

## トラブルシューティング

### 一般的な問題

1. **依存関係の不足**：pipで必要なパッケージをインストール
2. **Calibreが見つからない**：インタラクティブモードで自動ダウンロードを使用
3. **権限エラー**：管理者として実行するか、フォルダ権限を確認
4. **DRM保護ファイル**：DRM保護されたコンテンツは処理できません

### パフォーマンスのヒント

- 高速処理のためにSSDストレージを使用
- CPUコア数に基づいてワーカー数を調整
- 高速処理のために画像品質を下げる
- 大規模変換中は他のアプリケーションを閉じる

## 謝辞

このプロジェクトは、いくつかの優れたオープンソースライブラリとツールに依存しています：

### コア依存関係
- **[Calibre](https://calibre-ebook.com/)**：形式変換を可能にする強力な電子書籍管理・変換スイート
- **[PyMuPDF](https://pymupdf.readthedocs.io/)**：高性能PDF・画像処理
- **[Pillow](https://python-pillow.org/)**：画像操作のためのPython画像ライブラリ
- **[EbookLib](https://github.com/aerkalov/ebooklib)**：電子書籍作成・操作ライブラリ

### 追加ライブラリ
- **requests**：ウェブリクエスト用HTTPライブラリ
- **tqdm**：ユーザーエクスペリエンス向上のためのプログレスバーライブラリ
- **natsort**：ファイル整理のための自然ソート
- **argparse**：コマンドライン引数解析

### 特別な感謝
- **Calibreチーム**：最も包括的な電子書籍変換ツールを提供
